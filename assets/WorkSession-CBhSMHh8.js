import{d as V,u as H,a as T,c as h,l as b,o as B,s as R,b as r,g as m,e,t as a,p as J,j as g,i as l,_ as E}from"./index-5v6KPWdv.js";const W={key:0,class:"container"},$={class:"card mb-6"},O={class:"text-xl font-semibold text-gray-900 mb-4"},L={class:"text-gray-600 mb-4"},N={class:"grid grid-cols-2 gap-4 text-sm"},U={class:"font-medium"},q={class:"font-medium"},G={class:"font-medium"},K={class:"card mb-6"},Q={key:0,class:"text-center mb-6"},X={class:"text-3xl font-bold text-blue-600 mb-2"},Y=["disabled"],Z={class:"card mb-6"},ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},te={key:0,class:"aspect-video bg-gray-100 rounded-lg overflow-hidden mb-2"},oe=["src"],se={key:1,class:"aspect-video bg-gray-100 rounded-lg flex items-center justify-center mb-2"},ae=["disabled"],re={key:0,class:"aspect-video bg-gray-100 rounded-lg overflow-hidden mb-2"},le=["src"],ne={key:1,class:"aspect-video bg-gray-100 rounded-lg flex items-center justify-center mb-2"},ie=["disabled"],de={key:0,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"},ue={class:"bg-white p-4 rounded-lg w-full max-w-md mx-4"},ce={class:"mb-4"},ve={class:"text-lg font-semibold"},fe={class:"aspect-video bg-black rounded-lg overflow-hidden mb-4"},be=V({__name:"WorkSession",props:{jobId:{}},setup(j){const d=j,k=R(),x=H(),u=T(),o=h(()=>u.jobs.find(s=>s.id===d.jobId)),y=h(()=>o.value?.status==="in_progress"),C=h(()=>o.value?.status==="accepted"&&o.value?.installerId===x.user?.id),M=h(()=>o.value?.status==="in_progress"&&o.value?.installerId===x.user?.id),n=b(),p=b(),c=b(!1),v=b(null),S=b("");async function w(s){v.value=s;try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});n.value&&(n.value.srcObject=t,c.value=!0)}catch(t){console.error("Error accessing camera:",t),alert("Erro ao acessar a câmera. Verifique as permissões.")}}function _(){n.value?.srcObject&&(n.value.srcObject.getTracks().forEach(t=>t.stop()),n.value.srcObject=null),c.value=!1,v.value=null}function A(){if(!n.value||!p.value)return;const s=p.value,t=n.value;s.width=t.videoWidth,s.height=t.videoHeight;const i=s.getContext("2d");if(i){i.drawImage(t,0,0);const f=s.toDataURL("image/jpeg",.8);S.value=f,v.value==="before"?u.addBeforePhoto(d.jobId,f):v.value==="after"&&u.updateJob(d.jobId,{afterPhoto:f}),_()}}function P(){o.value&&u.startJob(d.jobId)}function z(){o.value&&o.value.afterPhoto?(u.completeJob(d.jobId,o.value.afterPhoto),k.push({name:"installer-dashboard"})):alert("É necessário tirar uma foto após o trabalho para concluir.")}function D(s){if(!s)return"00:00:00";const i=new Date().getTime()-s.getTime(),f=Math.floor(i/(1e3*60*60)),F=Math.floor(i%(1e3*60*60)/(1e3*60)),I=Math.floor(i%(1e3*60)/1e3);return`${f.toString().padStart(2,"0")}:${F.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}`}return B(()=>{o.value||k.push({name:"installer-dashboard"})}),(s,t)=>o.value?(l(),r("div",W,[e("div",$,[e("h2",O,a(o.value.title),1),e("p",L,a(o.value.description),1),e("div",N,[e("div",null,[t[2]||(t[2]=e("span",{class:"text-gray-600"},"Localização:",-1)),e("div",U,a(o.value.location),1)]),e("div",null,[t[3]||(t[3]=e("span",{class:"text-gray-600"},"Duração estimada:",-1)),e("div",q,a(o.value.duration)+"h",1)]),e("div",null,[t[4]||(t[4]=e("span",{class:"text-gray-600"},"Pagamento:",-1)),e("div",G,a(o.value.payment)+"€",1)]),e("div",null,[t[5]||(t[5]=e("span",{class:"text-gray-600"},"Status:",-1)),e("div",{class:J(["font-medium",o.value.status==="accepted"?"text-yellow-600":"text-green-600"])},a(o.value.status==="accepted"?"Aceito":"Em Andamento"),3)])])]),e("div",K,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Controle da Sessão",-1)),y.value&&o.value.startedAt?(l(),r("div",Q,[e("div",X,a(D(o.value.startedAt)),1),t[6]||(t[6]=e("div",{class:"text-sm text-gray-600"},"Tempo decorrido",-1))])):m("",!0),C.value?(l(),r("button",{key:1,onClick:P,class:"btn btn-success w-full mb-4"},t[7]||(t[7]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293H15M9 10v4a1 1 0 01-1 1H6a1 1 0 01-1-1V9a1 1 0 011-1h2M9 10V9a1 1 0 011-1h1M9 10H8a1 1 0 00-1 1v1M15 10v4a1 1 0 001 1h2a1 1 0 001-1V9a1 1 0 00-1-1h-2M15 10V9a1 1 0 00-1-1h-1M15 10h1a1 1 0 011 1v1"})],-1),g(" Iniciar Trabalho ",-1)]))):m("",!0),M.value?(l(),r("button",{key:2,onClick:z,class:"btn btn-primary w-full",disabled:!o.value.afterPhoto},t[8]||(t[8]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),g(" Concluir Trabalho ",-1)]),8,Y)):m("",!0)]),e("div",Z,[t[14]||(t[14]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Documentação Fotográfica",-1)),e("div",ee,[e("div",null,[t[11]||(t[11]=e("h4",{class:"font-medium text-gray-900 mb-2"},"Foto Antes",-1)),o.value.beforePhoto?(l(),r("div",te,[e("img",{src:o.value.beforePhoto,alt:"Foto antes",class:"w-full h-full object-cover"},null,8,oe)])):(l(),r("div",se,t[10]||(t[10]=[e("svg",{class:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1)]))),e("button",{onClick:t[0]||(t[0]=i=>w("before")),class:"btn btn-secondary w-full",disabled:c.value},a(o.value.beforePhoto?"Refazer Foto":"Tirar Foto Antes"),9,ae)]),e("div",null,[t[13]||(t[13]=e("h4",{class:"font-medium text-gray-900 mb-2"},"Foto Depois",-1)),o.value.afterPhoto?(l(),r("div",re,[e("img",{src:o.value.afterPhoto,alt:"Foto depois",class:"w-full h-full object-cover"},null,8,le)])):(l(),r("div",ne,t[12]||(t[12]=[e("svg",{class:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1)]))),e("button",{onClick:t[1]||(t[1]=i=>w("after")),class:"btn btn-secondary w-full",disabled:c.value||!y.value},a(o.value.afterPhoto?"Refazer Foto":"Tirar Foto Depois"),9,ie)])])]),c.value?(l(),r("div",de,[e("div",ue,[e("div",ce,[e("h3",ve,a(v.value==="before"?"Foto Antes do Trabalho":"Foto Depois do Trabalho"),1)]),e("div",fe,[e("video",{ref_key:"videoRef",ref:n,autoplay:"",class:"w-full h-full object-cover"},null,512)]),e("div",{class:"flex gap-2"},[e("button",{onClick:_,class:"btn btn-secondary flex-1"}," Cancelar "),e("button",{onClick:A,class:"btn btn-primary flex-1"},t[15]||(t[15]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})],-1),g(" Capturar ",-1)]))])])])):m("",!0),e("canvas",{ref_key:"canvasRef",ref:p,style:{display:"none"}},null,512)])):m("",!0)}}),he=E(be,[["__scopeId","data-v-77027343"]]);export{he as default};
